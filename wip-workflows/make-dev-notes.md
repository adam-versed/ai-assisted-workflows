(1863) Agentic Coding with Claude Code - YouTube

Transcripts:
(00:00) I think this should be live. Um post should be like confus. Okay. Um I have no idea if this works. This is an experiment. If you are uh if you can hear me or something, write something into the stream chat because I don't know what actually let me let me open the stream that there can be some sort of live update on what I'm doing.
(00:56) So like some sort of feedback. Um so yeah I have created this small little test project here just to maybe show a little bit how I'm doing this. Um okay so what I'm usually doing is I'm using plot code. There are a bunch of other options too. There's open code. Um there is AMP and a few others. And what all of these have in common is that they currently primarily run on the command line.
(01:27) and detached from your editor. So I'm actually using now VS Code for the most part. Again, I used to use cursor, but the way I'm working is I have cloth running here and I have an editor here and I use the editor to review and I'm using the editor primarily to um make some small changes to it. Right? So I have created this one little project here and I just want to show the agentic setup.
(02:00) So what am I doing for agents to work at all right? Um so the most important part here is to have a cloth MD file. This is actually autogenerated with slash in it and just I did some minor modifications to it. For almost every single project that I'm doing I use a make file. In fact, I would say for 100% of project I'm doing I have a make file and the make file acts as the main entry point for the agent to run things.
(02:32) So the agent pro code in particular will use bash, it will use python, it will it will write some code, it will run the code and it can dig itself out of um a bunch of nasty situations with this way. But I want to steer it in certain directions, right? And so what I usually have is a project overview. It just tells it what it is.
(02:53) Um I don't actually know if it's necessary. It will read the read me to um but it gives you some context. And then I give it immediately next the commands that it should use. The most important command here is make defaf. And the reason this is so important is because I actually don't really want it to run this command. I usually run this command myself.
(03:16) This brings up all the services. So this particular project has two services. As a front-end service, as a backend service and I tell it here that this brings up the server. It starts both the front end and the back end. I also tell it that it auto reloads and it auto compiles. Um, and I also tell it it should never stop the server.
(03:38) And that's actually one of the first important things here is that because it can do anything and in particular because I run it in yolo mode and it will just do anything. I also wanted to encourage it never to run in the wrong direction. Um, so it's kind of annoying to explain, but it can, for instance, stop the server and restart the server, and I really don't want it to do that. Um, okay.
(04:09) So, the audio doesn't quite work. Uh, let me see if I can fix something here. Um, I might have a might have overdone this. Uh, let me see. Let me maybe remove here. Let me let me know if the audio fixes itself a little bit. Uh if this is better. Um okay, I did I did the change here. Let me see if it works. But um basically I want it to stay on the path of of most success.
(04:47) And for this to work, I have to basically juggle me and the agent. So what I want to do is I want the deaf environment to be in my in to the front. I always want to see it, right? So I have claw up here doing stuff and I always have the dev server running things and I can see what it's doing.
(05:08) Right? So if I for instance go now to uh this website and I load it um well so far nothing has happened because it doesn't log requests but for instance if I were to hit the backend service let's say go to / API health I can see that a request was made right so I want to see how the server runs the server is always there for me um so that's the first most important thing I want the server to run in my terminal.
(05:39) I don't want cloth to run it in the background. The next thing is that I want to have a consistent log of all the things are happening. I've talked about this a couple of times, but this basically allows me to see front end and back end requests simultaneously even though they're from different services, right? One is the V server, the other one is my go server.
(05:57) But I also want to give this visibility to the agent, right? So one of the tools in here is this make tail lock command. So if I um run this here, basically I see the same thing as here. Um why is this important? Well, it is important because I want to get the agent to always understand how it establishes the context.
(06:24) Like if I'm talking about a bug with the agent, I want the agent to understand what's going on, right? So I will show in a minute how I'm doing this, but this is one of the reasons why this Taylor command is here. And then the other commands there as you would expect. How to run the llinter, how to run format, how to run clean. Um, it just that's the entry point of the tools that it should use.
(06:46) And then here really is the most important part about this. I'm telling it where the log files are. So I want to prevent it from guessing a bunch of other ways to establish um the context that it needs. Again I reaffirm that this is the command it should read uh use to read the log file and I also tell it to never stop the server.
(07:07) I also tell it that this server auto compiles and auto reloads right that's the most important part. So how do I have the auto reload setup the autoco compile setup? Well I use uh so there's a there's a problem called forman. I'm not using that. Um, and yeah, I think the problem is I probably don't have the right setup here for the the webcam.
(07:35) So, I might this might be confusing. Uh, because I I noticed earlier that the audio descends a little bit. Um, I need to get the setup working better. Uh, but I hope it's not the distracting otherwise I can just disable the webcam. Maybe this uh makes it less awkward. I just turn it off for now. uh because I think the webcam is is trailing a little bit here. Okay.
(07:57) So, I'm using a fork of foreman or a re-implementation of foreman called shoreman. Um you can find this on the internet. Uh forman long forman. Um it's this one here. And the reason I'm using this is because this is basically a very small shell script which does the same thing as forman. But I had to make some changes to it.
(08:20) It was easier for me to do the change in in shoreman. So what does it do? Um so I have a file here called proc file and it says this is the command to run for the front end and this is the command to run for the back end. And the front end is a basic V application um which auto reloads all the time. Right? So as I'm making changes to the front end, it automatically appears because it recompiles.
(08:47) And I have set up something very similar for the back end. I basically told it to use this watch exec tool. Um this is this one here. All that this does is it watches these files um specifically Go and SQL files and um it watches recursively this entire folder and then it runs this um this go run command um to uh to compile this.
(09:18) And so when I make a change here on my server let's say um I think this is might actually be unused at the moment. So let me completely delete this file. I don't want to use it. Right, it's gone. The server has recompiled. Right, that's that's that's all that is. Um then um go back to this. So so then I have this sort of very basic setup where at least these things log in um into this project.
(09:52) What in this project is not set up yet is that the server also the front end also logs into it. So if I go here and I issue um console log whatever I I don't see this here. Right? So that's actually one of the changes that I want to do and I want to show why this is useful. Um but basically that's the next thing that I want to set up is also get this uh to to to log into the server.
(10:20) Um I want to say one last thing about the the make command here. So I give it instructions in the cloud file, right? I'm I'm telling it these are the commands that you should run. There's some extra stuff down here about how I want this the structure of the project to be. But this is not alone.
(10:40) This alone is not enough to actually get it to work reliably um to work correctly. Right? So the reason I made changes to shoreman is because I actually discovered this is not doesn't take a long to discover this that um the tools work better if they are more descriptive in their error messages about um what what would what actually happened let's put this way right so one of the things that I changed into shoreman is that when shman runs it writes this file called shman pit and this is basically the um the the this master process running as a shell
(11:22) script. And if I run it a second time, checks if it's already running and then errors. But many tools do that, right? Many tools error when they're running. What this what I changed here is that I error in a way where if the agent reads the error, it is more likely to understand what happened.
(11:47) Right? So every once in a while, say the agent tries to do an HTTP request, but it makes the HTTP request right at the moment where the server restarts, right? And then it might see, oh, the server is not running, right? And it then it comes gets the idea to run make death, but the reality is that the server was actually running, right? And so when the agent now goes in and intentionally tries to start the server, it gets a slightly different error message than it would otherwise get, right? It now gets the error message, service is already running. That's good.
(12:11) We auto reload, no need to do anything, right? So it reinforces to the agent that it doesn't it shouldn't stop the server. It shouldn't kill a bunch of processes, right? Because the agent will it will start killing a bunch of stuff and restart it. And I don't want it, right? I I I want this service here to be very reliable.
(12:31) And when it tries to start it again, I wanted to get exactly the error message that it should get to not go off the beaten path, right? It should if it does accidentally run it now, it will it will realize, oh, it's actually running, right? Um so and you can see this right? So if I told tell the agent um I want you to start the dev services right it will run make defaf it gets an error but it says no action needed right so this is this is this works better than if it just errors out and says um showman already running or whatever
(13:10) the default is right so getting better error messages specifically for the agentic loop in is is one key part here. The second thing is of course that I changed shoreman to write these these log files correctly. So if we look into shoreman, well I can actually show this in a different way, right? So um there's um there's a def one that it writes and as you can see it only contains the messages from the current run.
(13:38) So if I restart this here, it starts out fresh. Um, so this is one of the changes that I found to work really really well is I'm I'm hiding away information that it will not need because otherwise if I have this ever growing log file then sometimes it picks up new work and it sees unrelated changes from yesterday for instance right um so that's um that's one of the other changes that I landed into showman um the Another thing is since there was already a question of docker compose, I do not actually use docker compose. Um I
(14:19) don't use any docker here and this is all running on my machine. If I were to put anything into docker then maybe I would care about docker compose. But this is just the most basic setup that I can have. Um okay. So uh let's make a change, right? Let's put the uh console forward plugin in.
(14:37) Um the reason I want this plugin is because it makes just iteration generally much easier. I just haven't set it up here yet. So that is this plugin. Um so I want it to set this up. Um so let's say please set up this plugin by your npm. And my English just sucks so it doesn't read me. Um okay. Let's see if it can do that. Right.
(15:07) So it should hopefully read this. Um I I can optimize a lot of these things, right? This probably also I could have done it manually. I just want to see if it works. Um one of the things for instance that slows down claude a lot right now is that it actually from scratch always tries to figure out what we're using here.
(15:28) So uh this might be one of the things we should put into this project is that we're using npm. Um so I didn't write this yet. So we can do this here. we always use npm as a package factor, right? This in theory should prevent it from using PNPM or something else that it might have. Um, it will only pick up on that when we uh start from scratch, but um in for future iterations maybe it will will improve this slightly.
(16:03) Um, another thing, it probably read the instructions incorrectly. I noticed the other day that I'm not documenting this correctly. I'm actually importing maybe I do it correctly, but I think I've done this once before and it always imports this incorrectly. So, I will manually fix this now because this should actually be like this.
(16:24) But in theory, uh plugin this should work. Um I noticed that this before that it always gets this wrong. Um but in theory now what what should happen is that if we log an error here we see it in the log, right? That that's what we want to accomplish here. And the whole point of this is that future iterations where uh we're we're coming where we're running into issues on the front end will also show up in the same block.
(17:09) Right? So now we have at least this this running. Um and let's see there's some changes here. Um let's do this. Um update to uh what do I want to say here? Setup console forward plugin and remove old pagionation. Okay, I got very lazy and use a lot of dictation now. Um okay, so let's try to set up some code here, right? That's that's really what we're here for.
(17:44) How can we make some changes to this? Um I actually don't find a chantic from the start to work particularly well. So I did actually bootstrap this with cloud code but I did already make some changes so that there's um an infrastructure that I like. So in particular for instance um at the very least I I picked my web framework or the router that I want to use.
(18:09) I set up some utilities in here to respond with errors. It's just the most basic kind of infrastructure that I wanted to use uh for building our API. The second thing that I did is I created a plan and this is this is basically all the things that I want to implement here, right? I I want to build a small bulletin board that's modeled after PHPB mostly but also 4chan.
(18:31) So I don't want to have user authentication. The idea is just that I'm using um what's called trip codes to authenticate um admin boards. So basically I have this this whole plan here that I want it to implement and I will not tell it to do this in one go but what I want to do is I want to have it look at the plan and tell me if it needs something else.
(18:57) So I created a plan in plan MD. I want you to ultra think about it and see if there are omissions in the plan that we need to fill in. So um so it will now read this file and ultra think is basically a hard-coded value in claude that also extends the thinking context window. So it will um use um more tokens to reason.
(19:31) Um one question came up is what dict dictation tool I'm using. I'm using two different ones. I'm trying um blow. The other one I'm using is called Voice Inc. I use them both for different things and I'm just tryinging different things right now. Um uh yeah, that's that's basically the answer to that. Um the reason I wanted to read through my plan is that it's actually quite good at telling me if there are omissions that will help it later.
(20:05) I don't usually use um this with cloth. Instead, what I usually do is I copy paste this entire thing into 03. So, let's do this here. Um I have a plan here. I want you to think hard about this plan and tell me if there are omissions to this plan that we should look into before we implement it. Let's put the plan and see what 03 is doing.
(20:36) Um so let's see what it came up with. Several omissions admin authentication. So how admin privileges granted verified. That's actually a good point. We didn't mention that. So uh let's do off here. Actually we already have a section up here. So um admin scan can reports admin permissions are hardcoded in an envir okay we we don't really have authentication maybe we just use um very very basic um http basic office we'll see we'll see um so most of this we will not actually do um this doesn't really matter the indexes I think like a lot of this
(21:31) stuff it will figure out along the way anyways mostly I want to see if there is some some very clear omission that we have um that we should clarify no so far this looks good see if if uh this came up with something thank you for giving me Uh, do I have to pick one? Uh, just want to quickly look through. Uh, okay.
(22:02) This one tells me that there are no deletions in it. That's a good point. Um, we will not do this for now. Uh, okay. So, so far, if we go to this bulletin board, there's nothing, right? There's um, uh, we haven't set up anything yet. Um, I get a warning here that the we're kind of using outdated packages for for the dev tools.
(22:33) I will leave this for now. I just don't want to spend too much time on the stream on the wrong things. But um yeah, the idea is basically that we're going to implement the feature. Now the only endpoint that I have right now is actually the uh help check endpoint. So we don't have much. We don't have any database code yet other than setting up the database once in the server.
(22:54) I think it's here somewhere. Um so let's see. So we like one API endpoint. And I think we're best to start with listing all the boards that exist. And because you cannot create a board right now because there's no admin panel, we're just going to hardcode a bunch of boards in the database. Um, so here we have migrations.
(23:19) So we ask it to make a new migration with two boards that it can just make up. And then we're going to list the boards. I want you to make an API endpoint that lists all the boards that exist. Because we do not yet have an API to create the boards. I want you to make a migrations and create two default boards. One called general and one called water cooler.
(23:43) Um let's see if this is good enough. Um I think I already wrote what the response for APIs largely should be. I think this is all um yeah. So let's do this. Each board in the response should post uh should contain the most recent topic and the most recent post. in addition to just the title and description. Okay, let's see what it does.
(24:21) So, let's see what the questions are in the meantime. Have I tried using CL to generate a file mapping in usable voice ink AI postp processing perform generation? Um, I have tried that. So far, I haven't. A lot of the things I'm doing at the moment are basically based on does it actually make anything work better.
(24:45) And I know I know that a lot of these AI tools can do quite impressive things, but very often it doesn't make any more productive. So I don't really like using voice inc or something like this to generate prompts to then have another prompt. So I much rather have command setup. Um but yeah, I haven't I haven't tried that so much. So it it kind it came up with a migration here uh board defaults.
(25:14) So um it will run this. One of the things you will notice is that in this project and in fact all of the code I'm writing now I'm I'm I'm asking it to write custom SQL. I I do not use an ORM. This is really because I always liked writing SQL manually. In fact, I really just like SQL. It's not that I enjoy SQL, but I like having as little of an indirection between me and the database.
(25:38) The main reason I don't do it when I don't use enchantic coding as much is because it is annoying to write SQL. But now that I have a machine write it for me, this beats to me having um like another indirection in place. So let's see what it does here. Um, I think it already does some things I don't like, but let's see.
(26:03) Um, most likely what's going to spit out is code I don't like. And then rather than it making more code like this, I just want to stick with the initial one. I want to fix it up because the more code exists that looks like what I want, the more likely it is that future API generations will kind of fit into this, right? That's sort of the idea.
(26:23) Um, yeah. And so, as you know, I basically I gave it all the permissions. I just let it write. I I I don't I don't do anything here, right? It's like I I just let it go. It has all the permissions to do everything on the system, which in parts could be a terrible idea, but seemingly plot code does really well. Um, right.
(26:49) So, it it managed to to run the API. uh it sees that there is a there's a response coming back from the API. So so it is working. Uh we can also go to the browser now and sort of test this. Um I think it called it boards, right? And so we see we see that there is a board and it actually has test posts in it. I'm assuming it has test posts in it because it just went to the database and created some. This is my guess.
(27:17) Uh I didn't actually see where it did it but this might be an interesting moment to look into the database. Uh so we have a database here called Mini DB. This was empty when we started earlier and it has created some posts here. Um I wonder when it when it created them. I didn't look. So uh when did it create them? Did it make me a test? So let's let's do this.
(27:46) Um let's check quickly which files uh we have here. So it must have created these manually through at which point did it create them. So it created some handlers. Um when did it create this is one of the reasons why the terminal interface is not very great because I don't have a search here. I have to quickly go through this and see um I don't actually know when it made the test when it made the posts but it it clearly created some some content in the database here. We'll just leave it now.
(28:24) Um this is this works good enough. Let's check the changes, right? So now we can see sort of how I do that. So I know that I changed these files, right? Because they're all modified. So we have a new route here. um boards. This is okay. I'm It's fine. I have a list boards. And so all of this is new, right? We only had the health check before.
(28:47) And now we have uh this. So it calls this get boards which is down here. Um I really don't like this, right? It it should not do this. All the database code should go into a separate module. So let's start with this here, right? Um, we need some changes. So, let's see. All the database queries should go into models/boards.go.
(29:15) Actually, we'll do go boards.go. Um, so that's the first that we want. So, we want this to go somewhere else. And this is okay. So, the board's response is okay. So, it will be a list of boards. Each board will be a database model. But this kind of thing here will be kind of weird because I want the model to represent a singular row only.
(29:39) So the model should only represent a singular row, not any uh joined records. Uh so we need to figure out how to best um query this board then to have this into um what is it doing here anyways? It is is running another query. So this is an n plus1 query anyways. That's probably good enough for now. Um so let's just say that you should move this over there.
(30:18) Um the topic let's go into models topic go and then we have the post should go models go. Um let's just see if it's if it manages to refactor this a little bit. Um and then we see from there what we need to do. Does pro code visual extension work if you're outside of visual code terminal? Um yes.
(30:54) So if the if the um if the integration set up correctly, it works even if it's running on the side, right? I can also start clawed in here, but I don't really like it. I prefer this terminal on the outside. Um but yeah, it these changes, they still show up. Um although I think that this comes actually from the Git plugin. Um, but we'll see what are questions there.
(31:16) Um, so maybe I should explain this because I didn't do this, but Lord Yulo, right? This here is just an alias for this impossible to pronounce argument called dangerously skip permissions, right? Basically, I run this all the time. Is it a good idea? I don't know. I'm not strongly advocating for it, but I can tell you that I'm using it this way all the time.
(31:46) Um, so that's why it doesn't ask me for anything. It just it it just edits. Um, what are my thoughts on Gemini CLI? I will re-evaluate it. Last time I was using it, the problem basically is that any model other than the entropic family of models is not overly amazing at tool use. usage. So I want to see that these agentic loop loops work.
(32:16) So that's why I'm playing with it. I have most success with claude. I also think that claude is the cheapest option because the 100 euro sorry $100 a month package in sonnet only mode is enough. Um and it's kind of hard to beat for the price right now, right? And I I don't know how long this price is going to stick here, but that's really why I'm not trying Gemini much.
(32:43) I have Gemini in the system. I sometimes give code access to Gemini to read through a codebase, but it's um I'm I want to get this working first, working well, and then I will try other tools again. I I also tried AMP. I tried a bunch of other ones, but um this is the one that um it's just I think it has the highest chance of sticking around also in part because the people that write the tool are also the people that write the model or create the model and so they go hand in hand.
(33:15) Um okay, so now we have a board go get all boards. This looks this looks quite a bit better. We don't need pageionation here because we don't expect that many boards. So that will be quite good. Um now it uses the scan to feed this. Then we have a G board by ID. Uh this is also quite okay. And the board by slug.
(33:39) I am quite okay with all of these. Um one of the consequences now that all of these methods can return null or board. So if the board doesn't exist, it returns null or nil. Um, do I like this? I don't know. Um, so we have this most recent post by board ID. Um, okay. So, so one of the things for sure that is not amazing is that it looks like the board doesn't have a pointer to the most recent topic but the topic has a post to the most recent post. So we maybe this is okay.
(34:28) I I I will not judge the database structure too much right now. Okay. So I think we can stick with this. In theory if we now go to here it should more look more or less the same. So we have a most recent topic most recent post. Um, let's actually remove the most recent post from um from the API because I don't think we need it.
(34:59) Um, so I wonder what is not the author is here. Okay, let's leave it for now. Let's leave it for now. But I think we will throw it away. So what I usually do when I program with this is I create myself a to-do file um where I basically keep track of all the stuff that I still need to do.
(35:20) So one is um call this nits um we should remove the most recent post from the board listing. Okay. So we will think of this later. So let's have a look at how the API response so far looks like. So we have a list port route um which is hooked up to the router um and it creates this boards response and then response with JSON and get board with recent is what it calls which is now it gets all the boards and then it gets the most recent topic and post Um yeah uh not overly amazing but kind of okay.
(36:07) But one of the things I do not like is this part here, right? Does HTTP error um and we have this utility here called internal server error. So we'll actually use this. So we call uh utils.in internal server error w and error. Then we remove the other one. So we want to do this and hopefully going forward we will actually start using this utility instead.
(36:37) Why do I want to use this utility? Well, for on hand because it locks the error and it returns with a standardized message. So that's why I want this. And um and then this is okay. And so board with recent is an extended strct that has the board in it plus the extra things here. So this is this is okay. Um so let's say we commit this.
(37:03) We leave this for later. Um so let's say edit basic port API response. So the next thing we want to do is we want to hook up the the front end, right? So if we go here, we don't see anything. So let's say we want to have the board show up. I want you to change the front end to show all the boards. Um, for now I want you to make sure that we create components for each row on the listing so that we can reuse this later.
(37:40) These rows should be reused for topics in a board as well as for the board listing overall. Um, we might need a parameter to change the actually I don't want this. Let me let me do this differently. Um I want you to now show all the boards the most recent topic in the overall uh in the index page on the index page.
(38:06) Um, and let's ignore the um I want to now this this might So the problem with whenever it creates a front end from nothing, it turns into a mess since there's basically no real front end. This might be incredibly messy and I'm a little bit afraid that it doesn't even manage to set up the router. Um, so I'll see what it does.
(38:35) I can we can watch it. In the meantime, I can look at some questions here. Yeah. So, for how to put the browser locks in a terminal, I used the V plugin that I wrote. Um, you can also do this yourself from API endpoint. The Vit plugin was this one here. Um, and this is what it does. Uh, one other question is about the font. The font I'm using is Monisa.
(39:02) I think all the time this one here uh that's the font. What other question? Yeah. So, one question is if you manually edit the code like that, do you have the problem that the model has unedited versions in the context? And yes, this is a problem. One of the problems with this is that it will recall things that you have already thrown away.
(39:27) This is actually a pretty big problem. Um, this is one of the reasons why I clear the context all the time. Um, the same problem, by the way, also comes up if you do code formatting. It's quite often that the llinter and the formatter uh edit the file in a certain way and sometimes they just get back and forth. I don't have a good solution for this, but it is a problem.
(39:47) Um, I can't really recommend anything here other than I do want to do these commits. Then I want to clear the context. Sometimes I maintain a to-do list. So before I run out of context, for instance, I tell the agent to summarize everything that it did into a file and I can look at this file later and then continue from there.
(40:12) Um, so let's see what it did. It probably has created something here. Um, so this is actually an interesting thing. It has not managed to run this, right? And so now, now we can probably see that our tooling comes in helpful hopefully. When I navigate to the page, I get a bunch of errors. Please check the log and see what's going on.
(40:35) Right. So, it should now read the log, which it does, and hopefully see what it broke. Um, okay, cool. So, it managed probably it wouldn't have needed the log, but having the log now means that it was just able to go back there and figure this out and at least we have something now, right? So, I not that I like how this looks at the moment.
(41:05) You can't even click on it or anything, but um yeah, we we see something. Um, let's make two changes here. I want these to be uh rows, so one below the other, not next to each other. And I also want to not show the most recent post. I only want to show the most recent topic. So, I just want to make this change. And then we're going to figure out how to make it less crappy.
(41:32) Um because it probably doesn't look very nice. Um, the way I do front- end code at the moment is I let it write a whole bunch of stuff and then I ask it to extract components. That usually sort of works. Um, but front end code unfortunately turns out to be very sloppy very quickly. Okay. So, um, okay, this at least is getting somewhere.
(42:01) Um, so let's see what it wrote. So it created an index route. Um so this is already we're already sort of down. Um if I So please link everything. This is already going to be annoying because it clearly left a bunch of nonsense behind and so the llinter will immediately complain hopefully that um there's unused stuff. So let's see. Um by the way in this project I'm not using any hooks.
(42:39) Um I do use some hooks in other ones but I wanted to start with the basics here. Uh okay so we we got rid of some unused stuff. Um I don't know what page this is. We're throwing this away for now. And then it created this API. TS. And this is already messy. I don't This is already too big. So the API client I'm actually okay with.
(43:02) It can leave that. But I don't like that the types are in the same file. So um let's do this. Move the types from API to t.ts into a separate file. API dot Yeah, it's into a separate file. Um actually other than the API client itself um let's see just kind of want to move this out. So the types are here now the API is here.
(43:43) One of the most important things is to make sure that the files don't grow too large. The larger the files, the harder it is for the for the system to work with it. Um, so this is this is this is okay for now. So, we're going to just have not the nicest thing here. I'm going to manually remove this welcome thing, which I think where do we have this? Where is this? It's here.
(44:09) Um, let's throw all of this away. So, we have only the boards. Um okay so we have a starting point the front end so far probably a little bit messy but um initial display of boards in the front end the problem immediately here now is going to be that um we don't have the router we have the router set up but we don't have query setup so I think it uses.
(44:45) No, it does use query. Okay, it does use query which is that's good. Um, and then it uses this get boards function. It might be okay. Oh, we will see. We'll see how messy it gets as we continue. Um, okay. So, what should we do next? I think next we're going to show each individual board. So, the next thing we need to do is we need to create these boards. So, let's do this.
(45:16) Um um I wonder if I should continue the session or not. Maybe we'll continue the session. Might be a bad idea but might actually help. Now please add an end point to show all the topics in one board. We will also actually no I will do I will I will do it from scratch here because I want to set up pageionation. Now we need an API endpoint to list all the topics in a board.
(45:43) Note for this we will need a pagionation helper. We want to use cursor based pageionation. That means not offset but to continue from a specific starting point. And we want to take the cursor to continue to the next page from the URL parameter because it's going to be a get request. Um, it's actually going to be shitty user experience because it means you can't jump to a specific page.
(46:14) So, we will not use cursors here. Um, going to use offset based page. Um, we want to take the take the page and per page parameter from the URL. Um, else it's going to be a get request. Default per page 250. Um, also return the total number of pages that exist. Don't hook this up to the front end yet. Okay, in the meantime, I have more questions.
(46:58) I do not use compact at all. Never ever use compact. If you run out of context, compact is basically a command that just screws up everything. Um, I don't know what happens if you compact. It's going to be a gamble. It's it's already random enough what happens out of the box, but I never never never run compact.
(47:20) Instead, if I notice that I'm running out of context, I'm asking Claude to summarize what it did into a markdown file. I review the markdown file, start a new session, and then read back from the markdown file. Um, because then at the very least, I know what it pulls in the context. Compact, I have no idea what it does.
(47:40) Um, I don't think the tool even shows you what it did after compacting. So, it's it's it's a gamble. It's a pure gamble. Um, never do that. Basically, um, auto compact is I rather have claw stop than auto compact because it's just so so random. It's it's absolute random. I also only use set. Um, I kind of wish I could use oppus more, but even the $200 subscription, I run out of opus.
(48:14) So I just stick myself to set and I use 03 for planning a lot where I basically go on um I take what I'm working on copy paste that into just jetpick 03 and have a conversation about my architecture there. Um and I can maybe show this later. I kind of want to hook up the trip codes to to post something and then we'll see um how well this works.
(48:42) So what I should have received here now in theory is uh what did we get here? We got the pagionation. So these are the parameters for the pagionation. We get an offset. Interesting. Why do we have an offset? Um okay. So we're pulling this from the query page and per page. The offset is calculated. Um and then this pageionation meta is probably used in the API response.
(49:16) So what did it do? So it lists the topics and this is a list of topics and a pageionation matter. Um do I like this? Do I like this? I don't know if I like this. Um do I like this? I don't know if I like this. We'll figure this out if I like this. Um, I think I might want to rename this a pageionation probably, but maybe this is good enough.
(49:45) Uh, so let's see. So in theory, there should be an API now for me to hit. Uh, API boards. Which one? Test. This has stuff in it. The slash. No. What's What's the API? Um, board. What's board? Board ID. Is it a board ID or is a board slug? Let's try what was the other API boards uh board ID one is a test board. We get something here.
(50:22) No, we don't get anything. Oh, slash topics. This okay board not found. So, we need a test probably. Okay. Um so we get this total one total pages one per page 10. So if you do page equals two we get an empty list three empty list. Okay this this is okay. Um I do want to change the meta to pagionation though. So I think we're just going to do it manually.
(51:03) I'm going to call this pagionation. Um, okay. So, heads up, I changed meta to pagionation. So, I just give it this context immediately interrupted just so that hopefully um it doesn't get confused later uh through my manual edit. Um there are some questions. I will quickly go to them. Have I used context 7? Yes.
(51:36) Um I don't have good experiences with it. I don't use any MCP servers other than playright and I try to not use playright either. Um then the other question uh yeah in general I don't like it looking up docs. I much rather give it the docs myself uh if it needs them. I I'm very conservative on context usage. I don't like any tools that pull anything in automatically.
(52:01) I optimize everything for low context usage. Um I want you to now register a URL for the board. So if a user goes to slashb/slug then we will show the most recent topics there and add a pageionation for previous and next page and a basic overview of how many pages exist and a quick jump to a particular page did manage um like slashb we have here slash uh slash test maybe just Um yeah, let's do SLB/ Slack. I like this.
(52:45) Um and show the So the topics there most recent first. Um and this is good. Note, we can always rely on monotonic increasing primary key integers for board order. um because we use SQLite here and I want to avoid uh it using dates right now. Um, also please use the link component to link from the index page to the board see okay let's see if it manages maybe in the meantime there's some questions uh again there was another question what I use for text to speech um right now this is using whisper flow I also use voice inc which is open source uh both
(53:42) of them work. Um, I just I'm triing Whisper this week. Um, normally I use Voice Inc. Um, they give or take equivalent on a Mac. Um, are there any other questions that I can answer in the meantime? Because I'm pretty sure this is going to take like four or five minutes for it to produce something reasonable. Um, earlier there was a question if I'm streaming.
(54:18) This is the first stream I've been doing in three years probably. So, we'll see if I will do this again. But, um, yeah, was kind of lazy. Um, yeah. So, how do I write the logs automatically to the deflog file? This is what I'm doing with Shman. So, if you do this in the meantime, let's put this on GitHub. Then you can sort of steal the Shman fork that I have.
(54:52) Um, do I want to put the whole thing up there? Let's make a readable mini. Create new repository. this right bullet bullet and import um bum bum create repo and then put this up there. So um in here in scripts there's my showman fork. Uh, I should probably now that this is on GitHub, I should probably make sure that the license is attributed correctly because I did not put this in.
(55:47) Uh, let's edit this quickly. Sure, man. It's always kind of funny if you have a bunch of white stuff because um you cannot really copyright any of this stuff. Um or very little there's going to be a bunch of core cases. Um edit license to man. Okay. Um but yeah, Sherman is is what I'm using for the for the locks.
(56:23) Hey, status. Okay. So, let's see. Um, do we have a front end now? So, I can click on this and I get not found. So, clearly it doesn't work. Um, I navigated to a board and it didn't work. Check the logs. Right. And this is again why the unified logging is so functional. It sees my browser logs, right? So, it doesn't just see the server.
(56:54) So, it should hopefully figure out what it did wrong. Um, I don't even know what happened because I I'm assuming that this wasn't too wrong that it did, right? Because there's a B board tsx. This should work, but maybe it doesn't. Um, so hold on. Could it be that we don't run the 10stack plugin for beat? Um, that would be a problem.
(57:27) Like, this is supposed to be 10, but uh because the plugin for 10 should do all of this. Um, so we probably don't have this plugin in there. Does it work now? Not so far. H because I didn't plug it in yet. Uh I actually think that this is Oh, look at this. But isn't this nice? I didn't even have to figure out what's going on.
(58:04) I Okay, I I did give it a hint that it has to set up the the plugin, but I mean, this is I love this. This is just so nice. Um, so here here you see one of the problems, right? So it it was in the wrong folder, so it couldn't figure out how to make the tail and then it immediately ran and went for the for the log itself.
(58:26) And that's one of the big problems right now why I'm so careful about giving it um the right context because it actually went the wrong way. It still managed to succeed, but it should really have cded into the right folder and run make tail lock there and it just didn't do it. And And this this is basically contributing to context fraud.
(58:46) Right now now it has remembered that this didn't work but this worked and it shouldn't right it it should not make these mistakes. Um and I'm I'm I'm trying to nudge it in the right direction. Um so one of the things I can try here now is that um on the make command maybe we can um honestly I I don't really have partially good results with this.
(59:09) If you fail to run the make file, um you have to remember that you have to run it from top level. Let's put it here. Um the commands, right? So, so maybe this will Oops. Maybe this will nudge it in the right direction. Um but can't guarantee, but still, I mean, like it's pretty cool. Okay. So, so we have this now.
(59:39) So, the board roughly works. So, let's double check quickly what it did. Um, so we have this is autogenerated. We don't care. Uh, now we have here a link. So, we can check this again. But it added the link component as instructed. It goes to the board and the board itself. Um, it has imagination somewhere here, but we don't really see it because we don't have enough topics.
(1:00:11) And now, now let's do this. Uh, now let's be creative. To test this better, I want you to generate 120 different posts across 10 different topics and put them into all the different boards that exist already. To make this easier, please write yourself a little test script. Um, and just actually, do I want it to write a test script or figure out itself? Um, just use Python for this.
(1:00:48) Use UV and put it into scripts. We might need this later again, right? So, I'm basically um actually hold on one last thing. Um but please use inference to generate a bunch of real sounding conversations and pipe them into an input file that this script will then use. Okay, so basically I want to get it into a situation where it now generates me out an entire board so I can test this better.
(1:01:24) Um, Mario, since you're writing back to Whisper Flow. Um, I'm tryinging them both, but the problem with Voice Inc. at the moment is that the AI integration just adds too much latency, and I want a little bit of fix up. Um, so for the screencast, I opted to Whisper Flow. Um, it's all about latency for me, and Whisper Flow is is it's just the lowest latency thing I found.
(1:01:53) Um so this is this is really really why um for me one of the really big benefits of agent decoding is actually test data generation because I'm actually struggling a lot with traditional applications that all of my test data just looks not great enough. Um, and now you can just get an LLM to really create you a pretty good looking test data and it makes it much easier to see the product, to feel the product, uh, and to experience what it looks like.
(1:02:30) Um, so that's just such a nice uh nice aspect of it. This is going to take a while, so maybe we go to questions. Um, try use T-Max for better lock tailing and running servers. I don't know. I I like what I have. Works good enough for me. Uh, what else is here? How do you disallow MCPS? I just don't load MCPS into my context in the first place.
(1:02:57) Um, one question is, do you have any experience with the amount of usage you get out of a $20 cloud subscription? I don't know is the short answer. Um, I think that you don't get that much out of it, but I'm not sure. You can try it and see. I can tell you that with a $100 Cloud subscription and you only use one agent at a time with Sonet, you're not going to hit the limits.
(1:03:28) With two or three simultaneously, you can hit the limits. Um, with a $200 subscription on Sonet, I don't think you can run out can run into the limits. I I don't think it's possible. Uh, but with the $20 one, I'm pretty sure that you can run out very quickly. Um, do you use the plan mode? So, because I use dangerously bypassing permissions, I don't really use the plan mode explicitly.
(1:03:56) And the problem for this is that it actually disables a bunch of things. So when it plans, it permanently asks for for permissions for all the tools. So I basically ask it to plan without plan mode because the plan mode, as far as I can tell, at least in parts auto activates just on prompting. Um but that's really why I don't use the plan mode.
(1:04:19) Um and and that's sort of the answer. So uh it's still generating. Um, yeah, they're they're like I think they're they're probably like 10 15 different pretty decent voice to text things at the moment um for all kinds of different setups and I think it's a little bit ridiculous to pay for whisper flow and I don't really like that because it is the magic is happening on device anyways um on on the whisper model which is the open source one.
(1:04:50) So, um yeah, I hope we just get to the point where um something like Whisper Flow in an open- source way um becomes like a like a thing that everybody contributes to. Um okay, so it's now generating boards. Cool. So, look at this. I have We have stuff to look at. Is it not nice? It just autogenerates all of it. Nice.
(1:05:14) Best setup for home office. Coffee setup for home office. Look at this. Um, cool. So, we have we have content, which is cool. And it wrote me this little script here um to populate the forum, right? I will not even look at the script. Don't have to. I don't care. It did its job. Um so what I will do now is I will commit this uh we'll do first we do web and we'll format this quickly and then we check in um edit board listing no topic listing and boards.
(1:06:05) Um, and now we add this scripts edit uh for relator script. So now that we have this, we can do one last thing where we do actually I should probably have checked what we had here. Um, anyways, doesn't matter. Next thing is we're going to enumerate the topics. Now I want you to make um a way to look at all the topics.
(1:06:42) So basically we are going to add an endpoint to see all the posts on a topic with pageionation. Same general API flow as we had for the uh board index page and we also want to add the front end component and the front end page to show that too and again also support pageionation. I don't know if this will work. Let's see.
(1:07:07) And I'll go to the questions anytime. Um, yeah, this monthly paying for basically local whisper models is nonsense. Um, I'm I'm actually quite okay for paying for the API inference, but I also don't think that I think it could actually fix up a lot of the little issues with voice input on a very well-trained local model, too. So, yeah. Um, CI is not an alias for commit.
(1:07:47) That's an alias that I set up. Um, so I have a I have an alias in my git config. is get config ci. So I have a bunch of these ones here. Um it was an alias on material which I was using before git and I got so used to it that when I moved to git I set up this alias and never went back. I have no idea what KI is.
(1:08:13) Uh oh you mean like Kim V2 the this new model? Is that is that is it the new huge model? Is that Kimi? I haven't tried it. I heard that it's pretty good on open code if you use it through uh I guess open router or something, but I haven't tried it. Um didn't have the time. Um okay. So very slowly this will start working at one point.
(1:08:47) We'll see. We'll see. I mean, this is not a very interesting uh screencast in many ways because this doesn't really show a chendicoding all that much because there's really not that much to see. I'm just adding more of the same. Now, if I still have some time, I think I have 20 minutes left. If I still have some time, I will try to add some tests.
(1:09:11) Um, which I think is more interesting. And there's a question, what do I usually do while waiting for Claude? Um, so this is the moment where I'm going to pitch VIP tunnel. This is a thing we built or actually I think I was barely involved at this point in this project. This is uh I think this is primarily now Mario's and Peter's project.
(1:09:31) Um but it's a way to basically run all of your cloud instances through the browser so I can go in for a coffee and then see what it's doing. Um that's the that's the general idea here. Um but the the answer of like what do you do while um while waiting for Claude is you go to Twitter and you write stuff I guess. Um see the problem with the the music is let's see let me see I need to I need to turn on the screen capture sound.
(1:10:02) So now hold on can you can you now hear the terrible music? No it doesn't work. Does it work? Can you hear it now? [Music] Anyways, that's the music. Uh, let's see if we see our topic. Um, it's still building front end. Uh, yeah. So maybe maybe here's an interesting thing. Why am I using Go? Uh Go is Go Go is a language I don't like.
(1:10:46) Um as a as a as a human writing code, actually maybe now that I'm sort of writing it more indirectly, I don't mind it quite as much, but I I kind of want to show why gold works so well for for a decoding. Um look at this. Okay, maybe this is the bad one. Maybe we're looking at the handlers. I mean, look at this.
(1:11:10) This you would not write in any other programming language than go right you wouldn't say if error not nil return internal survey error like I have one two three three branches just to handle survey errors and I know that there are ways in which I could do this differently and then return an error and like handle some of it on a higher level but my point mostly is in Python you wouldn't write it because it's ugly code in Rust you wouldn't write it because it's ugly code in Go a lot of Go code looks like this and
(1:11:46) it's perfectly fine. So the the the bar of error handling in Go is exactly that bar and and and agent are writing exactly that code. So it it is it is not any worse and one of the consequence of this like all the handling is local. So the it's very easy for the for the for the for the agent to understand what's going on because it doesn't have to look through so many layers of abstraction, right? It's it sees basically everything that's going on in this function is going on in this function and not anywhere else, right? It doesn't have to
(1:12:19) understand complicated error handling patterns elsewhere. It's pretty straightforward. That's why go is so good from a codewriting perspective. The other thing is that um all of the meta shenanigans that this language has is pretty pretty standard too. Like there's not a lot of complexity you need to understand.
(1:12:37) Yes, there's some attributes on it but it's good enough at at comprehending this. And the last part is if you run the go tests then it caches them. And so you can basically and I don't have the test set up yet, but you can with go you can basically tell it to run all the tests at all times without it slowing down um the aentic loop.
(1:12:55) And and that is so good because it means it never accidentally tests to narrow. So in Python I have it that it tests one function only because it explicitly only tests that function and it completely forgets that it 5 minutes ago broke another function and only at the very end it discovers that it made a huge mess.
(1:13:15) Um, and with go it just doesn't happen. Um, and I will show this in a bit, but um, now now supposedly I can look at the topic, but I'm actually not sure if that is correct because it doesn't seem to doesn't seem to work. So, um, well, I can click on something and nothing happens. Uh, what's going on? So when I click on a topic, nothing happens. I don't actually see the topic.
(1:13:47) I will stay on the board page. What's going on? But we can in the meantime look at the code that it generated. So we got more API to return posts. Um, then we get uh what's here? What do we have here? Get posttopic vagination. I'm assuming this is probably okay. Um, what did it do here? What did it do here? Where is in? That's why why do I have a parse intel listen? That's the kind of slope that that should go.
(1:14:40) So this this will go into our to-do list. Um get rid of percent. This slope should go away. Um okay. So, so this Okay. So, what do we have here? We have what's going on board T don't actually like that pick T. Why did it make this folder? Can delete this folder. Um, did it find the problem? Well, I don't think it I I think it's completely wrong on what it's trying to debug here.
(1:15:43) Um, but look, it's checking the route tree if it's regenerated. So, that's positive. Wait, I think it's the issue now. Um, this all wrong. Actually, I think the issue here is let me let me try. I think the issue here is that you need to create dollar port here. Then this has to become index tsx uh always I think it has to go here.
(1:16:35) Move and then this has to be t.ic. I think that this is how this works. Um, is this how it works or did I up everything now? What's going on? Uh, compare. Uh, okay. What's going on? All right. Okay, I broke everything. Classic. Um, but what did I break? Um, I think I broke something. That's it. It blocks. I'm always confused. So, not
(1:17:38) only am I confused by tens router, it's also that the LLM is confused by tens router. But I I I've been in this situation before and I think it's related to that it has to be in this right structure here. Um, yeah, look at this. Now it works. Um, okay, cool. So, welcome to the new forum. We see stuff here now.
(1:18:02) This works. Nice. Um, still slop though, but slightly better slope. So, let's commit this and then try to make a test. Let's finish it off by adding a test. Make format web edit public listing. Um, and maybe one last thing we could do is like actually add support for um, but I I want to write a test. I think I want to write.
(1:18:32) Let's see what else was written there. Um what how do you feed from it? Yeah. So so once more the the front end log to cloud code is basically ser is a front end I have a plug-in that forwards this. Um yeah this is this is nothing like cursor like even the cursor agent is is nothing like this like this is a completely different experience.
(1:18:58) Um okay so let's write some tests. This is what we're here for. Let's write some tests. So, we want to write some tests, but the problem with tests is that agents are not very good at writing tests. That's really the reality of all of this. So, we're going to write one test. Um, and I think we're going to actually before we write a test, we will write a way to create posts.
(1:19:28) I want you to add an internal function to create posts which we will then hook up to an API later but we don't hook it up yet. And we also want the function to create topics. So that is basically creating a post plus a topic in one go. And then I want you to write a singular test that creates uh No, no, no. I don't want it yet.
(1:19:58) Okay, let's do this APIs and I will make a test plan here. Um, test plan because the thing with the test plan is that um, here's how you usually want tests to work. How tests should work. All the database tests should use rollbacks. And that's actually the biggest problem because the way it wrote the test right now is it wrote it against the underlying SQLite code.
(1:20:34) And the problem with this is that this doesn't have enough abstraction to allow you to basically have implicit rollbacks. The the way I really like my code to work is that you can do something like this that you can do um this here. The way I like it is that you can write tests that insert insert insert insert but then they roll back.
(1:21:00) Um and for this to work we need to change too much because we need to basically if you go with post um right this here for instance it takes a SQLite DB but when you do a transaction when you basically do um we do txn error equals db begin I think right If error not null return n error, right? It has to be this, right? This here is a different type.
(1:21:38) Yeah, I also want I also want this different. Come on. Yeah, there we go. Um, so so this here this is not going to be a problem now because like my parameter here can be either a database or it can be a transaction, right? So, um, so for for my test setup to work, we basically have to refactor the entire code base. Um, and there just not amazing ways I think to do that.
(1:22:08) So, uh, this might be annoying. Let's see. Um, so create topic. Um, right. So, here we have this for, right? It creates a hat transaction. And now for for this to work with my intended roll back strategy, this also has to be save points. So this might be annoying. Um all the database code has to be changed so that we can use transactions and db.
(1:22:45) dbl Let's fill the PB there. So, this is going to be the point where maybe we're going to ask Gemini because I think actually I think that Sonet might not be able to do this uh in a good way. So, let's see. Um, how do we do this? How do we do this? So, let's commit these creators. um edit functionality seeing that do create posts and topics.
(1:23:23) So now we should we should come up with this test plan. Um let's let's see if Sonic can do it. Um, I want to write some tests, but the way we're doing database transactions right now doesn't work for how I want tests to work. Please ultra think how to rearchitect the code to support this better. Um, let's let it do this thing.
(1:24:01) H I just don't make it any more complicated. Um but there's just one way to test databases and that's rollbacks. And I think I think we might need to do this refactor. Uh any other question in the meantime? Uh no no other questions. So at least I think there no other questions. Uh so the git the git repo is on git already uh on github.
(1:24:39) It's here minb. Why did I call it minib? Uh it should be minib. It's minib. There you go. There you go. Um the other thing is like for for this authentic coding with streaming I don't I don't quite work like I work normally because first of all I don't talk all the time but I also don't stay engaged with the agent as much as I do right now.
(1:25:31) um there's a lot of waiting involved. So I tried to paralyze work. I tried to do other things in the meantime. So it's a little bit little bit different. Um so let's see what it did. Um it decided that we are going to use an interface called quer. Huh. Really? That's what we're going to do. I I don't think it's going to work.
(1:26:19) I don't think it's going to work, man. H Come on. Come on. Come on. Think hard for this problem. Does this actually work with nested transactions and safe points correctly? Because I don't think it works because it will have to know how deep it is. Um how do I distinguish between Crawl and Gemini? What we'll use Gemini for? Gemini model is excellent at programming.
(1:26:59) It is also excellent at thinking if you can call it this way and creating architecture and back and forths for this. Gemini CLI the command line tool it's not amazing and Gemini the model is not very good at tool usage. So for the aentic loop, I still haven't found anything better than set and the opus. But this is also why and I mentioned this earlier, I use all three and sometimes I use Gemini to plan larger changes and then I give the output of that to set and I just do that the planning of larger changes just in the
(1:27:36) UI in chip or in the AI studio for the most part. Um then there was a question of vector. I tried open telemetry and a bunch of other things. It creates too much nonsense, too much output with all of the spans that it produces and it didn't work quite as well as just the simple thing of logging everything into one file.
(1:28:05) Um I I actually struggle to make this work. Um and I find it also to be quite involved and also Gemini sorry Gemini uh cloth to just not fully understand how open telemetry works. So right now at least simple log files work incredibly well complicated hotel stuff I it doesn't work good enough for me. Um, I would actually love to see someone show how to use hotel successfully for aentic workflows.
(1:28:37) Just didn't work for me is is all I can say. Um, so what did it say? Um, what did it say about my uh my interjection? Did it say something? Why? So you're right. The question is my current address fundamental flaws with net transaction safe points. Um what how did you fix it then? I the problem is like I know how I set up this to normally work and I don't know if the AI can actually oneshot this.
(1:29:42) Okay, so it has a nesting level now. It has safe points. Maybe maybe. Okay, so we have a board test. So we have a setup test DB. So it creates a SQLite memory database. Ah, this is slop. Pure slope. Why do we do this? Why? Why? Great. Um, should run the real migrations. So you can already see at this point that this is it.
(1:30:23) I can already see that it's now no longer going to give good code and it doesn't even have that much stuff in the context, but it's already it's already making mistakes that it doesn't do on a smaller context. Like it's it's it went too narrow on one specific problem. Um, and this is the point where I no longer expect good output from this actually.
(1:30:45) Um, [Music] does it even manage to run migr migrations for testing? Let's run migration. Like why why are we doing this? And and what is begin tx here? Uh now it's now it's turning into full slop. Um and this all just for the test setup. So what I will do now is I will I will make a branch uh testing setup because I don't like any of this.
(1:31:44) um make format. So, we're going to um pretty initial test setup that doesn't quite work. So, we're we're going to we're going to we're going to go back to the drawing board here. Um so, um I I think this is this is awful. Um, this this might be really really awful. So, let's do a div to main. So, where where did the slope start? Um, this is might still be okay.
(1:32:29) So, the strategy now will be to unsloppify this and to get it to do something. And maybe the way of doing this will be to get the test harness to run. So the board test, we're going to make this not terrible. Um, so run migrations for testing should just be run migrations. Why is run migrations here in lower case? Because we have in it.
(1:33:04) Okay. So we have in it which runs migrations and that is what the server is doing. Right. So um um um so run migrations for testing does this instead. So let's start with this. Um take this and make a test utils package which creates the test harness. Run all add a test setup function which takes a callback which handles migrations database in memory and tear down.
(1:33:54) then update the tests to use this. I also want you to reuse the test database doing test runs so we don't waste quite as much. Um, actually I don't want to explain it but I don't want to migrate all the time basically. Um, and then we should test if this actually works. So, create, let's review this. Create post now uses QXAC.
(1:34:36) Um, and and so where let's see what we have begin dot begin. What do we do? Begin begin transaction go db go migration port test. Why this is this is just all nonsense. tests are the worst because it doesn't understand how to create a test harness. Um, this entire thing should go test transaction manager.
(1:35:34) So, setup test DB like what is it doing? What's it doing? All right. I might actually have to defer this to next time, but I would love it to at least set up the harness correctly. Um, so here's here's my best recommendation here at this moment. Don't set up tests initially with CL because it just doesn't understand how good tests should look like.
(1:36:15) And I don't know what it says about us as programmers, but the way it sets up tests is just bad. I can only assume that the bulk of people out there are writing horrible tests. Um all all of this is wrong. Like all of this is wrong. What what it should actually do is we should set up like a really good um transaction infrastructure in the beginning.
(1:36:37) Um the the the pattern I like to use here is actually from Django. Django has these atomic blocks. They work quite well and they hide safe points and transactions properly. So I should actually do that first. Get this in a good spot and only then start writing tests because everything that has done here so far is really really bad.
(1:36:56) Um, really bad. Yeah. So, um, I might do the following. I might let this run um and actually set up the tests correctly in a way that I like and then I will show either at a future stream or just in another um like a video or or just like a follow-up post of how to run the tests because I don't think we're going to get to a reasonable point in the next 20 minutes and I don't have that much time.
(1:37:33) I I gave myself an hour and a half and already over time. So maybe I will do two more minutes of last questions. Um yeah, but I think I will leave it here and then uh thank you so much for watching. See you next time.
